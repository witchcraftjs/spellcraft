<!DOCTYPE html><html class="default" lang="en" data-base="./"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@witchcraft/spellcraft</title><meta name="description" content="Documentation for @witchcraft/spellcraft"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script><script async src="assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="index.html" class="title">@witchcraft/spellcraft</a><div id="tsd-toolbar-links"><a href="https://github.com/witchcraftjs/spellcraft">Github</a><a href="https://github.com/witchcraftjs/spellcraft/issues">Issues</a><a href="http://npmjs.com/@witchcraft/spellcraft">npm</a></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>@witchcraft/spellcraft</h1></div><div class="tsd-panel tsd-typography"><p><a href="https://www.npmjs.com/package/@witchcraft/spellcraft/v/latest"><img src="https://img.shields.io/npm/v/%40witchcraft%2Fspellcraft/latest" alt="NPM Version (with latest tag)"></a></p>
<!-- [![NPM Version (with beta tag)](https://img.shields.io/npm/v/%40witchcraft%2Fspellcraft/beta)](https://www.npmjs.com/package/@witchcraft/spellcraft/v/beta) -->
<p><a href="https://github.com/witchcraftjs/spellcraft/actions/workflows/docs.yml"><img src="https://github.com/witchcraftjs/spellcraft/workflows/Docs/badge.svg" alt="Docs"></a>
<a href="https://github.com/witchcraftjs/spellcraft/actions/workflows/release.yml"><img src="https://github.com/witchcraftjs/spellcraft/actions/workflows/release.yml/badge.svg" alt="Release"></a></p>
<h1 id="spellcraft-ðŸª„" class="tsd-anchor-link">Spellcraft ðŸª„<a href="#spellcraft-ðŸª„" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1>
<p>A shortcut manager library for handling ALL the shortcut needs of an application.</p>
<h1 id="docs" class="tsd-anchor-link"><a href="https://witchcraftjs.github.io/spellcraft">Docs</a><a href="#docs" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1>
<h1 id="demo-please-report-any-issues" class="tsd-anchor-link"><a href="https://witchcraftjs.github.io/spellcraft/demo">Demo</a> (please report any issues)<a href="#demo-please-report-any-issues" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1>
<h1 id="features" class="tsd-anchor-link">Features<a href="#features" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1>
<ul>
<li>Manages anything key like (mouse + keyboard).
<ul>
<li>Modifiers, toggles, mouse buttons, and even the mouse wheel.</li>
</ul>
</li>
<li>Manages layouts.
<ul>
<li>Easy to create and layout keys in one go.</li>
<li>Provides mechanisms for handling left/right key variants in any way you like.</li>
<li>Optional auto key labeling.</li>
</ul>
</li>
<li>Supports shortcuts chains (e.g. <code>Ctrl+A B C</code>).
<ul>
<li>Has methods for swapping/moving parts of the chain with ease.</li>
</ul>
</li>
<li><a href="#usage-with-frameworks">Framework agnostic*</a>.</li>
<li>Hooks to allow listening to state changes and controlling whether shortcuts are valid, can be added, removed, modified, etc.</li>
<li>Easy error handling with type safe result monads.
<ul>
<li>e.g. to check a shortcut can be changed: <code>setShortcutProp(shortcut, &quot;chain&quot;, [...]).isOk</code></li>
</ul>
</li>
<li>Helper and utility functions for common use cases.</li>
<li>Heavily tested.</li>
</ul>
<h1 id="usage" class="tsd-anchor-link">Usage<a href="#usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1>
<p>This is a simple example of how you can quickly setup a manager.</p>
<pre><code class="ts"><span class="hl-0">// While a barrel &quot;@witchcraft/spellcraft&quot; import is available</span><br/><span class="hl-0">// for the root and all the parts of the library. It&#39;s</span><br/><span class="hl-0">// recommended to import the individual functions instead, </span><br/><span class="hl-0">// especially if using a bundler like vite which does not tree-shake</span><br/><span class="hl-0">// in dev mode. It will be faster.</span><br/><br/><span class="hl-1">import</span><span class="hl-2"> { </span><span class="hl-3">createManager</span><span class="hl-2"> } </span><span class="hl-1">from</span><span class="hl-2"> </span><span class="hl-4">&quot;@witchcraft/spellcraft/createManager&quot;</span><br/><span class="hl-1">import</span><span class="hl-2"> { </span><span class="hl-3">createKeys</span><span class="hl-2"> } </span><span class="hl-1">from</span><span class="hl-2"> </span><span class="hl-4">&quot;@witchcraft/spellcraft/createKeys&quot;</span><br/><span class="hl-1">import</span><span class="hl-2"> { </span><span class="hl-3">createContext</span><span class="hl-2"> } </span><span class="hl-1">from</span><span class="hl-2"> </span><span class="hl-4">&quot;@witchcraft/spellcraft/createContext&quot;</span><br/><span class="hl-1">import</span><span class="hl-2"> { </span><span class="hl-3">ERROR</span><span class="hl-2"> } </span><span class="hl-1">from</span><span class="hl-2"> </span><span class="hl-4">&quot;@witchcraft/spellcraft/types&quot;</span><br/><span class="hl-1">import</span><span class="hl-2"> </span><span class="hl-1">type</span><span class="hl-2"> { </span><span class="hl-3">Context</span><span class="hl-2"> } </span><span class="hl-1">from</span><span class="hl-2"> </span><span class="hl-4">&quot;@witchcraft/spellcraft/types&quot;</span><br/><span class="hl-1">import</span><span class="hl-2"> { </span><span class="hl-3">createCommand</span><span class="hl-2"> } </span><span class="hl-1">from</span><span class="hl-2"> </span><span class="hl-4">&quot;@witchcraft/spellcraft/createCommand&quot;</span><br/><span class="hl-1">import</span><span class="hl-2"> { </span><span class="hl-3">createShortcut</span><span class="hl-2"> } </span><span class="hl-1">from</span><span class="hl-2"> </span><span class="hl-4">&quot;@witchcraft/spellcraft/createShortcut&quot;</span><br/><span class="hl-1">import</span><span class="hl-2"> { </span><span class="hl-3">addCommand</span><span class="hl-2"> } </span><span class="hl-1">from</span><span class="hl-2"> </span><span class="hl-4">&quot;@witchcraft/spellcraft/addCommand&quot;</span><br/><span class="hl-1">import</span><span class="hl-2"> { </span><span class="hl-3">addShortcut</span><span class="hl-2"> } </span><span class="hl-1">from</span><span class="hl-2"> </span><span class="hl-4">&quot;@witchcraft/spellcraft/addShortcut&quot;</span><br/><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">manager</span><span class="hl-2"> = </span><span class="hl-7">createManager</span><span class="hl-2">({</span><br/><span class="hl-2">	</span><span class="hl-3">name:</span><span class="hl-2"> </span><span class="hl-4">&quot;default&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">	</span><span class="hl-0">// use/modify one of the layouts provided, or create your own (more below)</span><br/><span class="hl-2">	</span><span class="hl-3">keys:</span><span class="hl-2"> </span><span class="hl-7">createLayout</span><span class="hl-2">(</span><span class="hl-4">&quot;ansi&quot;</span><span class="hl-2">), </span><br/><span class="hl-2">	</span><span class="hl-3">commands:</span><span class="hl-2"> [</span><br/><span class="hl-2">		{</span><span class="hl-3">name:</span><span class="hl-2"> </span><span class="hl-4">&quot;makeBold&quot;</span><span class="hl-2">, </span><span class="hl-7">execute</span><span class="hl-3">:</span><span class="hl-2"> () </span><span class="hl-5">=&gt;</span><span class="hl-2"> {}},	</span><br/><span class="hl-2">	],</span><br/><span class="hl-2">	</span><span class="hl-3">shortcuts:</span><span class="hl-2"> [</span><br/><span class="hl-2">		{</span><span class="hl-3">chain:</span><span class="hl-2"> [[</span><span class="hl-4">&quot;ctrl&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;b&quot;</span><span class="hl-2">]], </span><span class="hl-3">command:</span><span class="hl-2"> </span><span class="hl-4">&quot;makeBold&quot;</span><span class="hl-2">},</span><br/><span class="hl-2">	],</span><br/><span class="hl-2">	</span><span class="hl-0">// a context to evaluate conditions on, you can use Context&lt;YourContextType&gt; to use anything you&#39;d like.</span><br/><span class="hl-2">	</span><span class="hl-3">context:</span><span class="hl-2"> </span><span class="hl-7">createContext</span><span class="hl-2">&lt;</span><span class="hl-8">Context</span><span class="hl-2">&lt;</span><span class="hl-8">Record</span><span class="hl-2">&lt;</span><span class="hl-8">string</span><span class="hl-2">, </span><span class="hl-8">boolean</span><span class="hl-2">&gt;&gt;&gt;({</span><br/><span class="hl-2">		</span><span class="hl-3">a:</span><span class="hl-2"> </span><span class="hl-5">false</span><br/><span class="hl-2">		</span><span class="hl-3">b</span><span class="hl-2">: </span><span class="hl-5">false</span><span class="hl-2">,</span><br/><span class="hl-2">	}),</span><br/><span class="hl-2">	</span><span class="hl-3">options:</span><span class="hl-2"> {</span><br/><span class="hl-2">		</span><span class="hl-0">// this is required to tell the manager how to evaluate conditions</span><br/><span class="hl-2">		</span><span class="hl-7">evaluateCondition</span><span class="hl-2">(</span><span class="hl-3">condition</span><span class="hl-2">, </span><span class="hl-3">context</span><span class="hl-2">) {</span><br/><span class="hl-2">			</span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-3">context</span><span class="hl-2">.</span><span class="hl-3">value</span><span class="hl-2">[</span><span class="hl-3">condition</span><span class="hl-2">.</span><span class="hl-3">text</span><span class="hl-2">]</span><br/><span class="hl-2">		},</span><br/><span class="hl-2">		</span><span class="hl-7">cb</span><span class="hl-2">(</span><span class="hl-3">_manager</span><span class="hl-2">, </span><span class="hl-3">error</span><span class="hl-2">, </span><span class="hl-3">e</span><span class="hl-2">) {</span><br/><span class="hl-2">			</span><span class="hl-0">// the manger can throw soft errors working, these can be handled here</span><br/><span class="hl-2">			</span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-3">error</span><span class="hl-2">.</span><span class="hl-3">code</span><span class="hl-2"> === </span><span class="hl-6">ERROR</span><span class="hl-2">.</span><span class="hl-6">UNKNOWN_KEY_EVENT</span><span class="hl-2">) {</span><br/><span class="hl-2">			} </span><span class="hl-1">else</span><span class="hl-2"> {</span><br/><span class="hl-2">				</span><span class="hl-0">// some other error (e.g. no shortcut available to trigger, multiple shortcuts found, etc)</span><br/><span class="hl-2">				</span><span class="hl-3">console</span><span class="hl-2">.</span><span class="hl-7">log</span><span class="hl-2">(</span><span class="hl-3">error</span><span class="hl-2">, </span><span class="hl-3">e</span><span class="hl-2">)</span><br/><span class="hl-2">			}</span><br/><span class="hl-2">		},</span><br/><span class="hl-2">	},</span><br/><span class="hl-2">	</span><span class="hl-7">listener</span><span class="hl-3">:</span><span class="hl-2"> ({ </span><span class="hl-3">event</span><span class="hl-2">, </span><span class="hl-3">manager</span><span class="hl-2">, </span><span class="hl-3">keys</span><span class="hl-2"> }) </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">		</span><span class="hl-0">// You can listen to all the events the manger listens to</span><br/><span class="hl-2">		</span><span class="hl-0">// and inspect how it&#39;s interpreting the keys.</span><br/><span class="hl-2">		</span><span class="hl-0">// This can also be used to label keys and</span><br/><span class="hl-2">		</span><span class="hl-0">// preventDefault some events when recording, more below.</span><br/><span class="hl-2">	},</span><br/><span class="hl-2">}).</span><span class="hl-7">unwrap</span><span class="hl-2">()</span><br/><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">command</span><span class="hl-2"> = </span><span class="hl-7">createCommand</span><span class="hl-2">(</span><span class="hl-4">&quot;test&quot;</span><span class="hl-2">, { </span><span class="hl-7">execute</span><span class="hl-3">:</span><span class="hl-2"> () </span><span class="hl-5">=&gt;</span><span class="hl-2"> {} })</span><br/><span class="hl-7">addCommand</span><span class="hl-2">(</span><span class="hl-3">command</span><span class="hl-2">,</span><span class="hl-3">manager</span><span class="hl-2">).</span><span class="hl-7">unwrap</span><span class="hl-2">()</span><br/><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">shortcut</span><span class="hl-2"> = </span><span class="hl-7">createShortcut</span><span class="hl-2">({</span><br/><span class="hl-2">	</span><span class="hl-3">chain:</span><span class="hl-2"> [[</span><span class="hl-4">&quot;a&quot;</span><span class="hl-2">]],</span><br/><span class="hl-2">	</span><span class="hl-3">command:</span><span class="hl-2"> </span><span class="hl-4">&quot;test&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">}, </span><span class="hl-3">manager</span><span class="hl-2">).</span><span class="hl-7">unwrap</span><span class="hl-2">()</span><br/><span class="hl-7">addShortcut</span><span class="hl-2">(</span><span class="hl-3">shortcut</span><span class="hl-2">,</span><span class="hl-3">manager</span><span class="hl-2">).</span><span class="hl-7">unwrap</span><span class="hl-2">()</span>
</code><button type="button">Copy</button></pre>

<h3 id="listening-to-events" class="tsd-anchor-link">Listening to Events<a href="#listening-to-events" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3>
<p>Then we need to attach the manager to the dom or an emulator* so it can listen to events.</p>
<pre><code class="ts"><span class="hl-0">// all listeners are created by default, but you can use the second parameter</span><br/><span class="hl-0">// to make it only create some of them</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">listeners</span><span class="hl-2"> = </span><span class="hl-7">createManagerEventListeners</span><span class="hl-2">(</span><span class="hl-3">manager</span><span class="hl-2">)</span><br/><br/><span class="hl-0">// then we can attach to the dom or an emulator</span><br/><span class="hl-0">// we can also pass options to some listeners</span><br/><span class="hl-0">// by default, the wheel listener is passive</span><br/><span class="hl-7">attach</span><span class="hl-2">(</span><span class="hl-3">el</span><span class="hl-2">, </span><span class="hl-3">listeners</span><span class="hl-2">, { </span><span class="hl-3">wheel:</span><span class="hl-2"> { </span><span class="hl-3">passive:</span><span class="hl-2"> </span><span class="hl-5">true</span><span class="hl-2"> } })</span><br/><span class="hl-0">// to later detach</span><br/><span class="hl-7">detach</span><span class="hl-2">(</span><span class="hl-3">el</span><span class="hl-2">, </span><span class="hl-3">listeners</span><span class="hl-2">, { </span><span class="hl-3">wheel:</span><span class="hl-2"> { </span><span class="hl-3">passive:</span><span class="hl-2"> </span><span class="hl-5">true</span><span class="hl-2"> } })</span><br/><span class="hl-0">// or listeners.abort()</span>
</code><button type="button">Copy</button></pre>

<p>* The emulator is for testing purposes and is not needed for virtual key presses (see <code>virtualPress/Toggle/Release</code>) which can be used to allow the user to &quot;press&quot; a key via some other mechanism (e.g. clicking a virtual keyboard).</p>
<h2 id="how-does-it-work" class="tsd-anchor-link">How Does It Work?<a href="#how-does-it-work" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>The listeners listen to all the events, look up the keys in the manager's key entries, then add/remove the keys from the manager's chain (<code>state.chain</code>). When a user presses a trigger key (non-modifier key), if there is a shortcut with the current chain as it's base, the manager will create a new chord on the next key press (<code>[[a]]</code> =&gt; <code>[[a], []]</code>).</p>
<p>The manager checks if the chain should trigger a shortcut, and triggers the corresponding <code>command.execute</code> both on <code>keyup</code> and <code>keydown.</code>. On <code>keydown</code> said shortcut is saved to <code>state.untrigger</code> in case we need to untrigger it early.</p>
<p>You can choose in your execute function what exactly to do at that point for both the <code>keyup</code> and the <code>keydown</code>. Usually you will want your logic to only run on keydown and you should clear the manager's chain with <code>safeSetManagerChain</code>.</p>
<p>If non-modifier keys are still being held at this point, the manager will not allow triggering a shortcut until they are released (see <code>state.isAwaitingKeyup</code>). Modifiers are not affect by this. We usually want the user to be able to keep the modifier pressed and do, for example, <code>Ctrl+B</code> then <code>Ctrl+I</code> to bold and italicize text, without having to release <code>Ctrl</code>, only <code>B</code> and <code>I</code>.</p>
<h2 id="errors-and-checking-if-actions-can-be-performed" class="tsd-anchor-link">Errors and Checking if Actions can be Performed<a href="#errors-and-checking-if-actions-can-be-performed" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>Note the use of <code>unwrap()</code>. Because many actions can throw &quot;soft&quot; errors, to better help deal with all the errors the library uses a Result monad in most of the return types. <code>unwrap</code> is like rust's unwrap and will throw the error if there was one, otherwise &quot;unwrap&quot; and return the value within.</p>
<p>For example, you could create a key like this if needed (e.g. when loading user configurations):</p>
<pre><code class="ts"><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">res</span><span class="hl-2"> = </span><span class="hl-7">createKey</span><span class="hl-2">(</span><span class="hl-3">key</span><span class="hl-2">.</span><span class="hl-3">id</span><span class="hl-2">, </span><span class="hl-3">key</span><span class="hl-2">)</span><br/><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-3">res</span><span class="hl-2">.</span><span class="hl-3">isError</span><span class="hl-2">) {</span><br/><span class="hl-2">	</span><span class="hl-0">// handle error</span><br/><span class="hl-2">	</span><span class="hl-3">res</span><span class="hl-2">.</span><span class="hl-3">error</span><span class="hl-2"> </span><span class="hl-0">// typed </span><br/><span class="hl-2">	</span><span class="hl-3">res</span><span class="hl-2">.</span><span class="hl-3">error</span><span class="hl-2">.</span><span class="hl-3">code</span><span class="hl-2"> </span><span class="hl-0">// see the ERROR enum</span><br/><span class="hl-2">	</span><span class="hl-3">res</span><span class="hl-2">.</span><span class="hl-3">error</span><span class="hl-2">.</span><span class="hl-3">info</span><span class="hl-2"> </span><span class="hl-0">// returns relevant objects</span><br/><span class="hl-2">} </span><span class="hl-1">else</span><span class="hl-2"> {</span><br/><span class="hl-2">	</span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-3">res</span><span class="hl-2">.</span><span class="hl-3">value</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<p>Many functions also offer the ability to pass <code>{check: true}</code> to check if they will succeed without actually doing anything. This is useful, for example, to check when dragging if a shortcut can be dragged to a key or not.</p>
<pre><code class="ts"><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">res</span><span class="hl-2"> = </span><span class="hl-7">setShortcutProp</span><span class="hl-2">(</span><span class="hl-3">shortcut</span><span class="hl-2">, </span><span class="hl-4">&quot;chain&quot;</span><span class="hl-2">, </span><span class="hl-3">newChain</span><span class="hl-2">, </span><span class="hl-3">manager</span><span class="hl-2">, { </span><span class="hl-3">check:</span><span class="hl-2"> </span><span class="hl-5">true</span><span class="hl-2"> })</span><br/><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-3">res</span><span class="hl-2">.</span><span class="hl-3">isOk</span><span class="hl-2">) {</span><br/><span class="hl-2">	</span><span class="hl-0">// ... shortcut can be changed</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<h1 id="advanced-usage-building-the-manager-piece-by-piece" class="tsd-anchor-link">Advanced Usage - Building the Manager Piece by Piece<a href="#advanced-usage-building-the-manager-piece-by-piece" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1>
<p>For more advanced use cases, you might want to build the manager piece by piece.</p>
<p>Above the example took in raw keys/lists and <code>createManager</code> internally converted and checked everything. But sometimes, like when loading a manager, it can be useful to do all this manually. For this there are several <code>create*</code> functions.</p>
<h2 id="manager-options" class="tsd-anchor-link">Manager Options<a href="#manager-options" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>Many of the functions need parts of the manager, including some of it's options to verify the creation of the keys/commands/shortcuts. For example, we can't be sure a shortcut is valid, unless we know the set of commands and keys that will be connected to it.</p>
<p>But we can't create a manager before creating a manager..., so instead we can create it's options first and pass those to the functions that need it:</p>
<pre><code class="ts"><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">options</span><span class="hl-2"> = </span><span class="hl-7">createManagerOptions</span><span class="hl-2">({</span><br/><span class="hl-2">		</span><span class="hl-7">evaluadeCondition</span><span class="hl-2">(</span><span class="hl-3">condition</span><span class="hl-2">, </span><span class="hl-3">context</span><span class="hl-2">) {</span><br/><span class="hl-2">		</span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-3">context</span><span class="hl-2">.</span><span class="hl-3">value</span><span class="hl-2">[</span><span class="hl-3">condition</span><span class="hl-2">.</span><span class="hl-3">text</span><span class="hl-2">]</span><br/><span class="hl-2">		},</span><br/><span class="hl-2">	</span><span class="hl-0">//...</span><br/><span class="hl-2">})</span>
</code><button type="button">Copy</button></pre>

<h2 id="keys-and-layouts" class="tsd-anchor-link">Keys and Layouts<a href="#keys-and-layouts" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>Then we need to create a layout. This is a list of keys in their raw form (they can be missing some properties), that describes the position of the keys and their width/height. <code>createLayout</code> is provided to help generate variations of the common ansi/iso layouts. We can then create real keys from these.</p>
<pre><code class="ts"><span class="hl-1">import</span><span class="hl-2"> { </span><span class="hl-3">createLayout</span><span class="hl-2"> } </span><span class="hl-1">from</span><span class="hl-2"> </span><span class="hl-4">&quot;@witchcraft/spellcraft/layouts/createLayout&quot;</span><br/><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">layout</span><span class="hl-2"> = </span><span class="hl-7">createLayout</span><span class="hl-2">(</span><span class="hl-4">&quot;ansi&quot;</span><span class="hl-2">, {</span><br/><span class="hl-2">	</span><span class="hl-3">numpad:</span><span class="hl-2"> </span><span class="hl-5">false</span><span class="hl-2"> </span><span class="hl-0">// don&#39;t add numbpad keys</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">keysList</span><span class="hl-2"> = </span><span class="hl-3">layout</span><span class="hl-2">.</span><span class="hl-7">map</span><span class="hl-2">(</span><span class="hl-3">key</span><span class="hl-2"> </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">	</span><span class="hl-0">// modify layout as you need</span><br/><span class="hl-2">	</span><span class="hl-0">//...</span><br/><span class="hl-2">	</span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-7">createKey</span><span class="hl-2">(</span><span class="hl-3">key</span><span class="hl-2">.</span><span class="hl-3">id</span><span class="hl-2">, </span><span class="hl-3">key</span><span class="hl-2">).</span><span class="hl-7">unwrap</span><span class="hl-2">()</span><br/><span class="hl-2">})</span>
</code><button type="button">Copy</button></pre>

<p>You can also build completely custom layouts, the <code>calculateAndSetPositionAndSize</code> helper is provided to make laying things out easier. It shifts the x position of the next key based on the previous key and auto sets width/height to 1 unit if not specified.</p>
<p><strong>Note: Key ids must be valid KeyboardEvent.code values, unless they are toggles, or have a list of variants. See <code>Key</code> docs for more info.</strong></p>
<pre><code class="ts"><span class="hl-1">import</span><span class="hl-2"> { </span><span class="hl-3">calculateAndSetPositionAndSize</span><span class="hl-2"> } </span><span class="hl-1">from</span><span class="hl-2"> </span><span class="hl-4">&quot;@witchcraft/spellcraft/helpers/calculateAndSetPositionAndWidth&quot;</span><br/><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">firstRow</span><span class="hl-2"> = </span><span class="hl-7">calculateAndSetPositionAndSize</span><span class="hl-2">([</span><br/><span class="hl-2">   { </span><span class="hl-3">id:</span><span class="hl-2"> </span><span class="hl-4">&quot;Escape&quot;</span><span class="hl-2"> </span><span class="hl-1">as</span><span class="hl-2"> </span><span class="hl-5">const</span><span class="hl-2">, </span><span class="hl-3">label:</span><span class="hl-2"> </span><span class="hl-4">&quot;Esc&quot;</span><span class="hl-2"> }, </span><span class="hl-0">// {x: 0, width: 1, height: 1}</span><br/><span class="hl-2">   </span><span class="hl-0">//	F1 needs to be shifted to skip 1 key unit</span><br/><span class="hl-2">   { </span><span class="hl-3">id:</span><span class="hl-2"> </span><span class="hl-4">&quot;F1&quot;</span><span class="hl-2"> </span><span class="hl-1">as</span><span class="hl-2"> </span><span class="hl-5">const</span><span class="hl-2">, </span><span class="hl-3">x:</span><span class="hl-2"> </span><span class="hl-9">2</span><span class="hl-2"> },</span><br/><span class="hl-2">   { </span><span class="hl-3">id:</span><span class="hl-2"> </span><span class="hl-4">&quot;F2&quot;</span><span class="hl-2"> </span><span class="hl-1">as</span><span class="hl-2"> </span><span class="hl-5">const</span><span class="hl-2"> },</span><br/><span class="hl-2">   { </span><span class="hl-3">id:</span><span class="hl-2"> </span><span class="hl-4">&quot;F3&quot;</span><span class="hl-2"> </span><span class="hl-1">as</span><span class="hl-2"> </span><span class="hl-5">const</span><span class="hl-2"> },</span><br/><span class="hl-2">   { </span><span class="hl-3">id:</span><span class="hl-2"> </span><span class="hl-4">&quot;F4&quot;</span><span class="hl-2"> </span><span class="hl-1">as</span><span class="hl-2"> </span><span class="hl-5">const</span><span class="hl-2"> },</span><br/><span class="hl-2">   </span><span class="hl-0">//	again after the 4th F* key, we shift one unit right</span><br/><span class="hl-2">   { </span><span class="hl-3">id:</span><span class="hl-2"> </span><span class="hl-4">&quot;F5&quot;</span><span class="hl-2"> </span><span class="hl-1">as</span><span class="hl-2"> </span><span class="hl-5">const</span><span class="hl-2">, </span><span class="hl-3">x:</span><span class="hl-2"> </span><span class="hl-9">6.5</span><span class="hl-2"> },</span><br/><span class="hl-2">   { </span><span class="hl-3">id:</span><span class="hl-2"> </span><span class="hl-4">&quot;F6&quot;</span><span class="hl-2"> </span><span class="hl-1">as</span><span class="hl-2"> </span><span class="hl-5">const</span><span class="hl-2"> },</span><br/><span class="hl-2">   { </span><span class="hl-3">id:</span><span class="hl-2"> </span><span class="hl-4">&quot;F7&quot;</span><span class="hl-2"> </span><span class="hl-1">as</span><span class="hl-2"> </span><span class="hl-5">const</span><span class="hl-2"> },</span><br/><span class="hl-2">   { </span><span class="hl-3">id:</span><span class="hl-2"> </span><span class="hl-4">&quot;F8&quot;</span><span class="hl-2"> </span><span class="hl-1">as</span><span class="hl-2"> </span><span class="hl-5">const</span><span class="hl-2"> },</span><br/><span class="hl-2">   </span><span class="hl-0">// and again</span><br/><span class="hl-2">   { </span><span class="hl-3">id:</span><span class="hl-2"> </span><span class="hl-4">&quot;F9&quot;</span><span class="hl-2"> </span><span class="hl-1">as</span><span class="hl-2"> </span><span class="hl-5">const</span><span class="hl-2">, </span><span class="hl-3">x:</span><span class="hl-2"> </span><span class="hl-9">11</span><span class="hl-2"> },</span><br/><span class="hl-2">   { </span><span class="hl-3">id:</span><span class="hl-2"> </span><span class="hl-4">&quot;F10&quot;</span><span class="hl-2"> </span><span class="hl-1">as</span><span class="hl-2"> </span><span class="hl-5">const</span><span class="hl-2"> },</span><br/><span class="hl-2">   { </span><span class="hl-3">id:</span><span class="hl-2"> </span><span class="hl-4">&quot;F11&quot;</span><span class="hl-2"> </span><span class="hl-1">as</span><span class="hl-2"> </span><span class="hl-5">const</span><span class="hl-2"> },</span><br/><span class="hl-2">   { </span><span class="hl-3">id:</span><span class="hl-2"> </span><span class="hl-4">&quot;F12&quot;</span><span class="hl-2"> </span><span class="hl-1">as</span><span class="hl-2"> </span><span class="hl-5">const</span><span class="hl-2"> },</span><br/><span class="hl-2">]).</span><span class="hl-7">map</span><span class="hl-2">(</span><span class="hl-3">_</span><span class="hl-2"> </span><span class="hl-5">=&gt;</span><span class="hl-2"> </span><span class="hl-3">_</span><span class="hl-2">.</span><span class="hl-3">y</span><span class="hl-2"> = </span><span class="hl-9">0</span><span class="hl-2">), </span><span class="hl-0">// y position is not set, so we set it</span>
</code><button type="button">Copy</button></pre>

<p>Rotation is not currently supported, but it's easy to add. You can extend the <code>BaseKey</code> interface yourself to add the needed properties. There's also the <code>NonToggleKey</code> and <code>ToggleKey</code> interfaces if you them.</p>
<pre><code class="ts"><span class="hl-0">// global.d.ts</span><br/><span class="hl-5">declare</span><span class="hl-2"> </span><span class="hl-5">module</span><span class="hl-2"> </span><span class="hl-4">&quot;@witchcraft/spellcraft/types/index&quot;</span><span class="hl-2"> {</span><br/><span class="hl-2">	</span><span class="hl-1">export</span><span class="hl-2"> </span><span class="hl-5">interface</span><span class="hl-2"> </span><span class="hl-8">BaseKey</span><span class="hl-2"> {</span><br/><span class="hl-2">		</span><span class="hl-3">yourProperty</span><span class="hl-2">:</span><span class="hl-8">string</span><br/><span class="hl-2">	}</span><br/><span class="hl-2">}</span><br/><span class="hl-1">export</span><span class="hl-2"> { }</span>
</code><button type="button">Copy</button></pre>

<p>Next you need to create a <code>Keys</code> object which describes a group of <code>Key</code>s. When keys are added/removed with <code>add/removeKey</code>, they will take care of adding/removing keys properly from the <code>Keys</code> since keys also need to be added to additional properties of <code>Keys</code> such as <code>toggles</code>, <code>variants</code>, etc. properties. These are used to speed up lookups and can be useful for searching for keys and or applying styles (e.g. <code>if (toggles[id]) // id is toggle</code>).</p>
<pre><code class="ts"><span class="hl-1">import</span><span class="hl-2"> { </span><span class="hl-3">createKeys</span><span class="hl-2"> } </span><span class="hl-1">from</span><span class="hl-2"> </span><span class="hl-4">&quot;@witchcraft/spellcraft/createKeys&quot;</span><br/><br/><span class="hl-0">// using the keysList and options we created above</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">keys</span><span class="hl-2"> = </span><span class="hl-7">createKeys</span><span class="hl-2">(</span><span class="hl-3">keysList</span><span class="hl-2">, </span><span class="hl-3">options</span><span class="hl-2">).</span><span class="hl-7">unwrap</span><span class="hl-2">()</span>
</code><button type="button">Copy</button></pre>

<h2 id="commands" class="tsd-anchor-link">Commands<a href="#commands" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>Command creation cannot error, so there is no unwrap.</p>
<p><code>command.execute</code> is of type <code>CommandExecute</code> if you need to type your command execute function separately.</p>
<pre><code class="ts"><span class="hl-1">import</span><span class="hl-2"> { </span><span class="hl-3">createCommand</span><span class="hl-2"> } </span><span class="hl-1">from</span><span class="hl-2"> </span><span class="hl-4">&quot;@witchcraft/spellcraft/createCommand&quot;</span><br/><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">command</span><span class="hl-2"> = </span><span class="hl-7">createCommand</span><span class="hl-2">(</span><br/><span class="hl-2">	</span><span class="hl-4">&quot;test&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">	{</span><br/><span class="hl-2">		</span><span class="hl-7">execute</span><span class="hl-3">:</span><span class="hl-2"> ({ </span><span class="hl-3">isKeydown</span><span class="hl-2">, </span><span class="hl-3">command</span><span class="hl-2">, </span><span class="hl-3">shortcut</span><span class="hl-2">, </span><span class="hl-3">event</span><span class="hl-2">, </span><span class="hl-3">manager</span><span class="hl-2"> }) </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">		</span><span class="hl-0">// note that event might be undefined if using virtual key presses</span><br/><span class="hl-2">		</span><span class="hl-0">// the manager and shortcut might also be undefined</span><br/><span class="hl-2">		</span><span class="hl-0">// this is to allow calling the command manually without the library</span><br/><span class="hl-2">		},</span><br/><span class="hl-2">		</span><span class="hl-0">// commands can also have their own conditions that must be met</span><br/><span class="hl-2">		</span><span class="hl-3">condition:</span><span class="hl-2"> </span><span class="hl-7">createCondition</span><span class="hl-2">(</span><span class="hl-4">&quot;a || b&quot;</span><span class="hl-2">)</span><br/><span class="hl-2">	}</span><br/><span class="hl-2">)</span><br/><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">commandSet</span><span class="hl-2"> = </span><span class="hl-7">createCommands</span><span class="hl-2">([</span><br/><span class="hl-2">	</span><span class="hl-3">command</span><span class="hl-2">,</span><br/><span class="hl-2">	</span><span class="hl-0">// command2</span><br/><span class="hl-2">], </span><span class="hl-3">options</span><span class="hl-2">).</span><span class="hl-7">unwrap</span><span class="hl-2">()</span>
</code><button type="button">Copy</button></pre>

<h2 id="conditions" class="tsd-anchor-link">Conditions<a href="#conditions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p><code>Condition</code> is just an object that provides a wrapper the library understands, it does not actually implement evaluation, etc. For that you can use a seperate library, like <a href="https://github.com/witchcraftjs/expressit">expressit</a> which I created for this purpose.</p>
<p>This is why we <em>must</em> tell the manager how to evaluate conditions.</p>
<p>To extend <code>Condition</code> and add properties to it, you can extend the <code>Condition</code> interface yourself.</p>
<pre><code class="ts"><span class="hl-0">// global.d.ts</span><br/><span class="hl-1">import</span><span class="hl-2"> </span><span class="hl-1">type</span><span class="hl-2"> { </span><span class="hl-3">ConditionNode</span><span class="hl-2">, </span><span class="hl-3">ExpressionNode</span><span class="hl-2">, </span><span class="hl-3">GroupNode</span><span class="hl-2"> } </span><span class="hl-1">from</span><span class="hl-2"> </span><span class="hl-4">&quot;@witchcraft/expressit/types&quot;</span><br/><span class="hl-5">declare</span><span class="hl-2"> </span><span class="hl-5">module</span><span class="hl-2"> </span><span class="hl-4">&quot;@witchcraft/spellcraft/types/index&quot;</span><span class="hl-2"> {</span><br/><span class="hl-2">	</span><span class="hl-1">export</span><span class="hl-2"> </span><span class="hl-5">interface</span><span class="hl-2"> </span><span class="hl-8">Condition</span><span class="hl-2"> {</span><br/><span class="hl-2">		</span><span class="hl-3">ast</span><span class="hl-2">?: </span><span class="hl-8">ExpressionNode</span><span class="hl-2"> | </span><span class="hl-8">ConditionNode</span><span class="hl-2"> | </span><span class="hl-8">GroupNode</span><br/><span class="hl-2">	}</span><br/><span class="hl-2">}</span><br/><span class="hl-1">export</span><span class="hl-2"> { }</span>
</code><button type="button">Copy</button></pre>

<p>Additionally, when you create a condition, you can pass a function to <code>parse</code> it and add these needed properties:</p>
<p>You'll probably want to create a wrapping function to do this. Here's an example with the expressit library:</p>
<details>
<summary>Click to Expand</summary>
<pre><code class="ts"><span class="hl-1">import</span><span class="hl-2"> { </span><span class="hl-3">ShortcutContextParser</span><span class="hl-2"> } </span><span class="hl-1">from</span><span class="hl-2"> </span><span class="hl-4">&quot;@witchcraft/expressit/examples/ShortcutContextParser&quot;</span><br/><span class="hl-1">import</span><span class="hl-2"> { </span><span class="hl-3">createCondition</span><span class="hl-2"> </span><span class="hl-1">as</span><span class="hl-2"> </span><span class="hl-3">_createCondition</span><span class="hl-2"> } </span><span class="hl-1">from</span><span class="hl-2"> </span><span class="hl-4">&quot;@witchcraft/spellcraft&quot;</span><br/><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">dummyContext</span><span class="hl-2"> = { </span><span class="hl-3">a:</span><span class="hl-2"> { }, </span><span class="hl-3">b:</span><span class="hl-2"> { </span><span class="hl-3">c:</span><span class="hl-2"> {} } }</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">shortcutParser</span><span class="hl-2"> = </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-7">ShortcutContextParser</span><span class="hl-2">(</span><span class="hl-3">dummyContext</span><span class="hl-2">) </span><span class="hl-0">// see docs for details</span><br/><span class="hl-5">function</span><span class="hl-2"> </span><span class="hl-7">parser</span><span class="hl-2">(</span><span class="hl-3">text</span><span class="hl-2">: </span><span class="hl-8">string</span><span class="hl-2">, </span><span class="hl-3">_</span><span class="hl-2">: </span><span class="hl-8">Condition</span><span class="hl-2">) {</span><br/><span class="hl-2">	</span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">res</span><span class="hl-2"> = </span><span class="hl-3">shortcutsParser</span><span class="hl-2">.</span><span class="hl-7">parse</span><span class="hl-2">(</span><span class="hl-3">text</span><span class="hl-2">)</span><br/><span class="hl-2">	</span><span class="hl-0">// === undefined is to narrow out the ErrorToken type</span><br/><span class="hl-2">	</span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-3">res</span><span class="hl-2">.</span><span class="hl-3">valid</span><span class="hl-2"> || </span><span class="hl-3">res</span><span class="hl-2">.</span><span class="hl-3">type</span><span class="hl-2"> === </span><span class="hl-5">undefined</span><span class="hl-2">) {</span><br/><span class="hl-2">		</span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-7">Error</span><span class="hl-2">(</span><span class="hl-4">`Shortcut context parser failed to parse condition </span><span class="hl-5">${</span><span class="hl-3">_</span><span class="hl-10">.</span><span class="hl-3">text</span><span class="hl-5">}</span><span class="hl-4">`</span><span class="hl-2">)</span><br/><span class="hl-2">	}</span><br/><br/><span class="hl-2">	</span><span class="hl-3">_</span><span class="hl-2">.</span><span class="hl-3">ast</span><span class="hl-2"> = </span><span class="hl-3">res</span><br/><span class="hl-2">	</span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-3">_</span><br/><span class="hl-2">}</span><br/><br/><span class="hl-0">/** Creates a condition with the ast saved in it. */</span><br/><span class="hl-5">function</span><span class="hl-2"> </span><span class="hl-7">createCondition</span><span class="hl-2">(</span><span class="hl-3">text</span><span class="hl-2">: </span><span class="hl-8">string</span><span class="hl-2">) {</span><br/><span class="hl-2">	</span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-7">_createCondition</span><span class="hl-2">(</span><span class="hl-3">text</span><span class="hl-2">, </span><span class="hl-3">parser</span><span class="hl-2">)</span><br/><span class="hl-2">}</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">condition</span><span class="hl-2"> = </span><span class="hl-7">createCondition</span><span class="hl-2">(</span><span class="hl-4">&quot;a || b&quot;</span><span class="hl-2">)</span><br/><span class="hl-3">condition</span><span class="hl-2">.</span><span class="hl-3">ast</span><span class="hl-2"> </span><span class="hl-0">// should exist</span><br/><br/><span class="hl-0">// tell the manager how to evaluare the condition:</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">manager</span><span class="hl-2"> = </span><span class="hl-7">createmanager</span><span class="hl-2">({</span><br/><span class="hl-2">	</span><span class="hl-3">context:</span><span class="hl-2"> </span><span class="hl-7">createcontext</span><span class="hl-2">&lt;</span><span class="hl-8">context</span><span class="hl-2">&lt;</span><span class="hl-8">map</span><span class="hl-2">&lt;</span><span class="hl-8">string</span><span class="hl-2">, </span><span class="hl-8">boolean</span><span class="hl-2">&gt;&gt;&gt;(</span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-7">map</span><span class="hl-2">()),</span><br/><span class="hl-2">	</span><span class="hl-3">options:</span><span class="hl-2"> {</span><br/><span class="hl-2">		</span><span class="hl-7">evaluatecondition</span><span class="hl-2">(</span><span class="hl-3">condition</span><span class="hl-2">, </span><span class="hl-3">context</span><span class="hl-2">) {</span><br/><span class="hl-2">			</span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-3">condition</span><span class="hl-2">.</span><span class="hl-3">ast</span><span class="hl-2"> === </span><span class="hl-5">undefined</span><span class="hl-2">) </span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-7">Error</span><span class="hl-2">(</span><span class="hl-4">&quot;condition ast is undefined&quot;</span><span class="hl-2">)</span><br/><br/><span class="hl-2">			</span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">res</span><span class="hl-2"> = </span><span class="hl-3">condition</span><span class="hl-2">.</span><span class="hl-3">ast</span><span class="hl-2">.</span><span class="hl-3">valid</span><span class="hl-2"> </span><br/><span class="hl-2">				? </span><span class="hl-3">conditionParser</span><span class="hl-2">.</span><span class="hl-7">evaluate</span><span class="hl-2">(</span><br/><span class="hl-2">					</span><span class="hl-3">conditionParser</span><span class="hl-2">.</span><span class="hl-7">normalize</span><span class="hl-2">(</span><span class="hl-3">condition</span><span class="hl-2">.</span><span class="hl-3">ast</span><span class="hl-2">),</span><br/><span class="hl-2">					</span><span class="hl-3">context</span><span class="hl-2">.</span><span class="hl-3">value</span><span class="hl-2">.</span><span class="hl-3">isActive</span><br/><span class="hl-2">				) </span><br/><span class="hl-2">				: </span><span class="hl-5">false</span><span class="hl-2"> </span><br/><span class="hl-2">			</span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-3">res</span><br/><span class="hl-2">		},</span><br/><span class="hl-2">	}</span><br/><span class="hl-2">})</span><br/>
</code><button type="button">Copy</button></pre>

</details>
<h2 id="contexts" class="tsd-anchor-link">Contexts<a href="#contexts" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>Similarly with contexts, you can use any sort of object or type that you like.</p>
<p>You can tell the manager it's type when you create it. For example, say we wanted to use a map:</p>
<pre><code class="ts"><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">manager</span><span class="hl-2"> = </span><span class="hl-7">createmanager</span><span class="hl-2">({</span><br/><span class="hl-2">	</span><span class="hl-3">context:</span><span class="hl-2"> </span><span class="hl-7">createcontext</span><span class="hl-2">&lt;</span><span class="hl-8">context</span><span class="hl-2">&lt;</span><span class="hl-8">map</span><span class="hl-2">&lt;</span><span class="hl-8">string</span><span class="hl-2">, </span><span class="hl-8">boolean</span><span class="hl-2">&gt;&gt;&gt;(</span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-7">map</span><span class="hl-2">()),</span><br/><span class="hl-2">	</span><span class="hl-3">options:</span><span class="hl-2"> {</span><br/><span class="hl-2">		</span><span class="hl-7">evaluatecondition</span><span class="hl-2">(</span><span class="hl-3">condition</span><span class="hl-2">, </span><span class="hl-3">context</span><span class="hl-2">) {</span><br/><span class="hl-2">			</span><span class="hl-0">// context is now correctly typed</span><br/><span class="hl-2">			</span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-3">context</span><span class="hl-2">.</span><span class="hl-3">value</span><span class="hl-2">.</span><span class="hl-7">has</span><span class="hl-2">(</span><span class="hl-3">condition</span><span class="hl-2">.</span><span class="hl-3">text</span><span class="hl-2">)</span><br/><span class="hl-2">		},</span><br/><span class="hl-2">	}</span><br/><span class="hl-2">})</span>
</code><button type="button">Copy</button></pre>

<h2 id="shortcuts" class="tsd-anchor-link">Shortcuts<a href="#shortcuts" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>Creating a shortcut requires a the key/commands we created and the manager options to create a valid shortcut.</p>
<pre><code class="ts"><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">shortcut</span><span class="hl-2"> = </span><span class="hl-7">createShortcut</span><span class="hl-2">({</span><br/><span class="hl-2">	</span><span class="hl-3">command:</span><span class="hl-2"> </span><span class="hl-4">&quot;test&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">	</span><span class="hl-3">chain:</span><span class="hl-2"> [[</span><span class="hl-4">&quot;a&quot;</span><span class="hl-2">]],</span><br/><span class="hl-2">	</span><span class="hl-3">condition:</span><span class="hl-2"> </span><span class="hl-7">createCondition</span><span class="hl-2">(</span><span class="hl-4">&quot;a || b&quot;</span><span class="hl-2">),</span><br/><span class="hl-2">	</span><span class="hl-3">enabled:</span><span class="hl-2"> </span><span class="hl-5">true</span><span class="hl-2">,</span><br/><span class="hl-2">}, {</span><span class="hl-3">options</span><span class="hl-2">, </span><span class="hl-3">keys</span><span class="hl-2">, </span><span class="hl-3">commands</span><span class="hl-2">}).</span><span class="hl-7">unwrap</span><span class="hl-2">()</span><br/><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">shortcuts</span><span class="hl-2"> = </span><span class="hl-7">createShortcuts</span><span class="hl-2">([</span><br/><span class="hl-2">	</span><span class="hl-3">shortcut</span><span class="hl-2">,</span><br/><span class="hl-2">	</span><span class="hl-0">// shortcut2</span><br/><span class="hl-2">], {</span><span class="hl-3">options</span><span class="hl-2">, </span><span class="hl-3">keys</span><span class="hl-2">, </span><span class="hl-3">commands</span><span class="hl-2">}).</span><span class="hl-7">unwrap</span><span class="hl-2">()</span><br/>
</code><button type="button">Copy</button></pre>

<p>At this point we can create the manager. This time, because we passed full <code>Keys/Commands/Shortcuts</code> objects, the manager will not create them internal as it does when you pass it raw keys/commands/etc.</p>
<p>We should also set the listener at this point to prevent default events while recording, and to label keys automatically if we want (see <code>labelWithEvent</code> and <code>labelWithKeyboardMap</code> for details).</p>
<pre><code class="ts"><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">manager</span><span class="hl-2"> = </span><span class="hl-7">createManager</span><span class="hl-2">({</span><br/><span class="hl-2">	</span><span class="hl-3">keys</span><span class="hl-2">,</span><br/><span class="hl-2">	</span><span class="hl-3">commands</span><span class="hl-2">,</span><br/><span class="hl-2">	</span><span class="hl-3">shortcuts</span><span class="hl-2">,</span><br/><span class="hl-2">	</span><span class="hl-3">options</span><span class="hl-2">,</span><br/><span class="hl-2">	</span><span class="hl-7">listener</span><span class="hl-3">:</span><span class="hl-2"> ({ </span><span class="hl-3">event</span><span class="hl-2">, </span><span class="hl-3">manager</span><span class="hl-2">, </span><span class="hl-3">keys</span><span class="hl-2"> }) </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">		</span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-3">event</span><span class="hl-2">) </span><span class="hl-1">return</span><br/><span class="hl-2">		</span><span class="hl-7">labelWithEvent</span><span class="hl-2">(</span><span class="hl-3">event</span><span class="hl-2">, </span><span class="hl-3">keys</span><span class="hl-2">, </span><span class="hl-3">manager</span><span class="hl-2">)</span><br/><span class="hl-2">		</span><span class="hl-0">// this is only an example, the specifics, depend on how you implement recording</span><br/><span class="hl-2">		</span><span class="hl-1">if</span><span class="hl-2"> (</span><br/><span class="hl-2">			</span><span class="hl-3">manager</span><span class="hl-2">.</span><span class="hl-3">state</span><span class="hl-2">.</span><span class="hl-3">isRecording</span><br/><span class="hl-2">			&amp;&amp; !(</span><span class="hl-3">event</span><span class="hl-2"> </span><span class="hl-5">instanceof</span><span class="hl-2"> </span><span class="hl-8">MouseEvent</span><span class="hl-2">)</span><br/><span class="hl-2">			&amp;&amp; </span><span class="hl-4">&quot;preventDefault&quot;</span><span class="hl-2"> </span><span class="hl-5">in</span><span class="hl-2"> </span><span class="hl-3">event</span><br/><span class="hl-2">		) {</span><br/><span class="hl-2">			</span><span class="hl-0">// prevent default effect of keys when recording</span><br/><span class="hl-2">			</span><span class="hl-3">event</span><span class="hl-2">.</span><span class="hl-7">preventDefault</span><span class="hl-2">()</span><br/><span class="hl-2">		}</span><br/><span class="hl-2">	},</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-0">//in either case, keys and commands are typed</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">keyA</span><span class="hl-2"> = </span><span class="hl-3">manager</span><span class="hl-2">.</span><span class="hl-3">keys</span><span class="hl-2">.</span><span class="hl-3">entries</span><span class="hl-2">.</span><span class="hl-3">KeyA</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">testCommand</span><span class="hl-2"> = </span><span class="hl-3">manager</span><span class="hl-2">.</span><span class="hl-3">commands</span><span class="hl-2">.</span><span class="hl-3">entries</span><span class="hl-2">.</span><span class="hl-3">test</span>
</code><button type="button">Copy</button></pre>

<h2 id="changingsetting-properties-and-hooks" class="tsd-anchor-link">Changing/Setting Properties and Hooks<a href="#changingsetting-properties-and-hooks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>A series of <code>set*Prop</code> functions are provided to safely set properties on keys, shortcuts, etc. We pass these the manager to give the functions context so they can tell whether a given action is ok.</p>
<p>When we create the manager, we can also pass additional restrictions using <code>hooks</code> or just hook in to listen to events (e.g. in the demo, these are used to trigger saving).</p>
<pre><code class="ts"><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">manager</span><span class="hl-2"> = </span><span class="hl-7">createManager</span><span class="hl-2">({</span><br/><span class="hl-2">	</span><span class="hl-0">// ...</span><br/><span class="hl-2">	</span><span class="hl-3">hooks:</span><span class="hl-2"> {</span><br/><span class="hl-2">		</span><span class="hl-7">onSetShortcutProp</span><span class="hl-2">(...</span><span class="hl-3">args</span><span class="hl-2">) {</span><br/><span class="hl-2">			</span><span class="hl-1">throw</span><span class="hl-2"> </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-7">CustomError</span><span class="hl-2">(</span><span class="hl-4">&quot;You can&#39;t change the shortcuts.&quot;</span><span class="hl-2">)</span><br/><span class="hl-2">		}</span><br/><span class="hl-2">	}</span><br/><span class="hl-2">})</span><br/><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">res</span><span class="hl-2"> = </span><span class="hl-7">setShortcutProp</span><span class="hl-2">(</span><span class="hl-3">shortcut</span><span class="hl-2">, </span><span class="hl-4">&quot;chain&quot;</span><span class="hl-2">, </span><span class="hl-3">newChain</span><span class="hl-2">, </span><span class="hl-3">manager</span><span class="hl-2">)</span><br/><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-3">res</span><span class="hl-2">.</span><span class="hl-3">isError</span><span class="hl-2">) {</span><br/><span class="hl-2">	</span><span class="hl-0">// res.error is now typed as all the errors setting this property can throw</span><br/><span class="hl-2">	</span><span class="hl-0">// + CustomError</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

<p>Note that while the built in errors are property specific, custom errors are not.</p>
<h2 id="managing-multiple-managers" class="tsd-anchor-link">Managing Multiple Managers<a href="#managing-multiple-managers" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>A helper class <code>ShortcutManagerManager</code> is provided to help manage multiple managers.</p>
<details>
<summary>Click to Expand</summary>
<pre><code class="ts"><span class="hl-1">import</span><span class="hl-2"> { </span><span class="hl-3">ShortcutManagerManager</span><span class="hl-2"> } </span><span class="hl-1">from</span><span class="hl-2"> </span><span class="hl-4">&quot;@witchcraft/spellcraft&quot;</span><br/><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">managerManager</span><span class="hl-2"> = </span><span class="hl-5">new</span><span class="hl-2"> </span><span class="hl-7">ShortcutManagerManager</span><span class="hl-2">(</span><br/><span class="hl-2">	</span><span class="hl-3">raw</span><span class="hl-2"> </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">		</span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-7">yourCreateDefaultManager</span><span class="hl-2">(</span><span class="hl-3">raw</span><span class="hl-2">)</span><br/><span class="hl-2">	},</span><br/><span class="hl-2">	{</span><br/><span class="hl-2">		</span><span class="hl-7">onError</span><span class="hl-3">:</span><span class="hl-2"> (</span><span class="hl-3">e</span><span class="hl-2">) </span><span class="hl-5">=&gt;</span><span class="hl-2"> </span><span class="hl-7">notifyUserHere</span><span class="hl-2">(</span><span class="hl-3">e</span><span class="hl-2">),</span><br/><span class="hl-2">		</span><span class="hl-7">onParse</span><span class="hl-3">:</span><span class="hl-2"> (</span><span class="hl-3">parsed</span><span class="hl-2">: </span><span class="hl-8">any</span><span class="hl-2">) </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">			</span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">isValid</span><span class="hl-2"> = </span><span class="hl-7">yourValidationFunction</span><span class="hl-2">(</span><span class="hl-3">parsed</span><span class="hl-2">)</span><br/><span class="hl-2">			</span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-3">isValid</span><span class="hl-2">) </span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-7">Error</span><span class="hl-2">()</span><br/><span class="hl-2">			</span><span class="hl-0">// connect the commands to the real command functions</span><br/><span class="hl-2">			</span><span class="hl-0">// you should NEVER save/parse the command functions, that&#39;s a security risk</span><br/><br/><span class="hl-2">			</span><span class="hl-1">for</span><span class="hl-2"> (</span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">commandName</span><span class="hl-2"> </span><span class="hl-5">of</span><span class="hl-2"> </span><span class="hl-7">objectKeys</span><span class="hl-2">(</span><span class="hl-3">parsed</span><span class="hl-2">.</span><span class="hl-3">commands</span><span class="hl-2">.</span><span class="hl-3">entries</span><span class="hl-2">)) {</span><br/><span class="hl-2">				</span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">command</span><span class="hl-2">: </span><span class="hl-8">Command</span><span class="hl-2"> = </span><span class="hl-3">parsed</span><span class="hl-2">.</span><span class="hl-3">commands</span><span class="hl-2">.</span><span class="hl-3">entries</span><span class="hl-2">[</span><span class="hl-3">commandName</span><span class="hl-2">]</span><br/><span class="hl-2">				</span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">commandExec</span><span class="hl-2"> = </span><span class="hl-7">getYourCommandFunction</span><span class="hl-2">(</span><span class="hl-3">commandName</span><span class="hl-2">)</span><br/><span class="hl-2">				</span><span class="hl-0">// @ts-expect-error execute is typically considered readonly</span><br/><span class="hl-2">				</span><span class="hl-3">command</span><span class="hl-2">.</span><span class="hl-3">execute</span><span class="hl-2"> = </span><span class="hl-3">commandExec</span><br/><span class="hl-2">			}</span><br/><span class="hl-2">			</span><span class="hl-0">//	it&#39;s recommended you use some sort of versioning system</span><br/><span class="hl-2">			(</span><span class="hl-3">parsed</span><span class="hl-2"> </span><span class="hl-1">as</span><span class="hl-2"> </span><span class="hl-8">any</span><span class="hl-2">).</span><span class="hl-3">__version</span><span class="hl-2"> = </span><span class="hl-6">VERSION</span><br/><span class="hl-2">		},</span><br/><span class="hl-2">		</span><span class="hl-7">onSave</span><span class="hl-3">:</span><span class="hl-2"> (</span><span class="hl-3">clone</span><span class="hl-2">: </span><span class="hl-8">any</span><span class="hl-2">) </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">			</span><span class="hl-0">// do any further cleanup here</span><br/><span class="hl-2">			</span><span class="hl-1">for</span><span class="hl-2"> (</span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">shortcut</span><span class="hl-2"> </span><span class="hl-5">of</span><span class="hl-2"> </span><span class="hl-3">clone</span><span class="hl-2">.</span><span class="hl-3">shortcuts</span><span class="hl-2">.</span><span class="hl-3">entries</span><span class="hl-2">) {</span><br/><span class="hl-2">				</span><span class="hl-5">delete</span><span class="hl-2"> </span><span class="hl-3">shortcut</span><span class="hl-2">.</span><span class="hl-3">condition</span><span class="hl-2">.</span><span class="hl-3">ast</span><br/><span class="hl-2">			}</span><br/><span class="hl-2">			(</span><span class="hl-3">clone</span><span class="hl-2"> </span><span class="hl-1">as</span><span class="hl-2"> </span><span class="hl-8">any</span><span class="hl-2">).</span><span class="hl-3">__version</span><span class="hl-2"> = </span><span class="hl-6">VERSION</span><br/><span class="hl-2">		},</span><br/><span class="hl-2">		</span><span class="hl-7">onExport</span><span class="hl-2">(</span><span class="hl-3">res</span><span class="hl-2">: </span><span class="hl-8">object</span><span class="hl-2">) {</span><br/><span class="hl-2">			</span><span class="hl-0">// prompt browser to save file</span><br/><span class="hl-2">		},</span><br/><span class="hl-2">		</span><span class="hl-0">// update your state when the class does</span><br/><span class="hl-2">		</span><span class="hl-7">onSetActiveManager</span><span class="hl-3">:</span><span class="hl-2"> (</span><span class="hl-3">managerName</span><span class="hl-2">: </span><span class="hl-8">string</span><span class="hl-2">) </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">		},</span><br/><span class="hl-2">		</span><span class="hl-7">onSetManagerNames</span><span class="hl-3">:</span><span class="hl-2"> (</span><span class="hl-3">names</span><span class="hl-2">: </span><span class="hl-8">string</span><span class="hl-2">[]) </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">		},</span><br/><span class="hl-2">		</span><span class="hl-7">onSetManager</span><span class="hl-3">:</span><span class="hl-2"> (</span><span class="hl-3">name</span><span class="hl-2">: </span><span class="hl-8">string</span><span class="hl-2">, </span><span class="hl-3">manager</span><span class="hl-2">: </span><span class="hl-8">Manager</span><span class="hl-2">) </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">		}</span><br/><span class="hl-2">	},</span><br/><span class="hl-2">	{</span><br/><span class="hl-2">		</span><span class="hl-3">storageKeys</span><span class="hl-2"> </span><span class="hl-0">// change the keys used</span><br/><span class="hl-2">		</span><span class="hl-3">storage</span><span class="hl-2"> </span><span class="hl-0">// change the storage used (localStorage by default), it just needs to be able to setItem/getItem/removeItem</span><br/><span class="hl-2">	}</span><br/><span class="hl-2">)</span><br/><span class="hl-0">// actually attempt to load the saved managers</span><br/><span class="hl-3">managerManager</span><span class="hl-2">.</span><span class="hl-7">init</span><span class="hl-2">()</span><br/><span class="hl-0">// change/create a manager, force means it wont error if the manager doesn&#39;t exist</span><br/><span class="hl-0">// and instead creates it</span><br/><span class="hl-3">managerManager</span><span class="hl-2">.</span><span class="hl-7">changeManager</span><span class="hl-2">(</span><span class="hl-4">&quot;myManagerName&quot;</span><span class="hl-2">, { </span><span class="hl-3">force:</span><span class="hl-2"> </span><span class="hl-5">true</span><span class="hl-2"> })</span><br/><span class="hl-3">managerManager</span><span class="hl-2">.</span><span class="hl-7">duplicateManager</span><span class="hl-2">(</span><span class="hl-4">&quot;myManagerName&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;myDuplicateManagerName&quot;</span><span class="hl-2">)</span><br/><span class="hl-3">managerManager</span><span class="hl-2">.</span><span class="hl-7">deleteManager</span><span class="hl-2">(</span><span class="hl-4">&quot;myManagerName&quot;</span><span class="hl-2">)</span><br/><span class="hl-3">managerManager</span><span class="hl-2">.</span><span class="hl-7">renameManager</span><span class="hl-2">(</span><span class="hl-4">&quot;myManagerName&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;myNewManagerName&quot;</span><span class="hl-2">)</span>
</code><button type="button">Copy</button></pre>

</details>
<p>You can then use the active manager's <code>onSet*Prop</code> hooks to call debouncedSave. You can wrap only the active manager to intercept all it's <code>onSet*Prop</code> calls. See the <code>useMultipleManagers</code> composable in the demo.</p>
<h2 id="other-helpers-and-utilities" class="tsd-anchor-link">Other Helpers and Utilities<a href="#other-helpers-and-utilities" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>There are many helpers provided to simplify common use cases under <code>/helpers</code>. Some notable ones are:</p>
<ul>
<li><code>equals*</code> functions for checking equality.</li>
<li><code>calculateLayoutSize</code> for calculating the total size of a layout in key units</li>
<li><code>safeSetManagerChain</code> for safely setting of the state of the manager's chain.</li>
<li><code>shortcutCanExecuteIn</code> and <code>shortcutIsTriggerableBy</code>.</li>
<li><code>virtualPress/Toggle/Release</code> for virtual key presses (allowing a click on a virtual keyboard to trigger a key press).</li>
<li><code>getKeyboardLayoutMap</code> for getting the keyboard layout map needed for <code>labelWithKeyboardMap</code>.</li>
<li><code>shortcutSwapChords</code> for swapping the base chords of shortcuts.</li>
<li><code>generateKeyShortcutMap</code> This is a complex helper that generates a map, keyed by all the key id's, with info regarding what shortcuts can be pressed. This is crucial for showing a visual representation of the shortcuts on the keys depending on the current key state as is done in the demo.</li>
</ul>
<p>There's also some smaller utility functions in <code>/utils</code>:</p>
<ul>
<li><code>equals/dedupe/clone/*Key</code> These are particularly important for manipulating chords. This is because keys which are variants of eachother (see <code>Key.variants</code>) do not have matching ids and we usually want to be able to dedupe by the variants as well.</li>
<li><code>isAny/Trigger/Wheel/MouseKey</code>.</li>
<li><code>getKeyCodesFromKeys</code> for getting the raw key codes from a list of keys for use with third-party libraries.</li>
</ul>
<p>There's also a few other functions that in the future might be moved from the demo were I created them and into the library. See <a href="https://github.com/AlansCodeLog/spellcraft/tree/master/demo/src/common">demo/src/common</a>.</p>
<h2 id="more-examples" class="tsd-anchor-link">More Examples<a href="#more-examples" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>I'm currently working polishing the library and making it easier to use.</p>
<p>Many of the methods/properties have extensive documentation with examples.</p>
<p>For a more advanced example, you can look at the <a href="https://alanscodelog.github.io/spellcraft/demo">demo</a> and it's <a href="https://github.com/AlansCodeLog/spellcraft/tree/master/demo">code</a>.</p>
<p>There are also extensive tests you can look at, specifically the <a href="https://github.com/AlansCodeLog/spellcraft/tree/master/tests/Manager.spec.ts">tests/Manager.spec.ts</a> file.</p>
<h2 id="usage-with-frameworks" class="tsd-anchor-link">Usage with Frameworks<a href="#usage-with-frameworks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>Originally this was written with classes, but that kind of grew into a tangled mess and it made it hard to override/customize functionality and save objects. It also made it hard to work with frameworks, even proxy-based ones.</p>
<p>Now everything is just a plain object. The library still mutates everything directly and that is unlikely to change*, but in frameworks like vue which allow deep reactivity, this should work perfectly. In frameworks that don't, I would suggest a library like valtio to be able to use proxy based reactivity, or set listeners on all state and copy it all each time.</p>
<p>The reason the library mutates objects directly is that some changes can cause multiple other changes to happen (for example, safely setting the manager's chain can touch a lot of state) and making the library immutable would is expensive for frameworks that don't need it.</p>
<p>* The other possibility is to add immutable versions of the <code>set*</code> functions and the listeners.</p>
<h1 id="development" class="tsd-anchor-link"><a href="documents/DEVELOPMENT.html">Development</a><a href="#development" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1>
<h2 id="notes" class="tsd-anchor-link">Notes<a href="#notes" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>Under gnome at least, if a key (usually Ctrl) is set to locate the cursor, it will not send any key events. It will only be detected when pressed with another key.</p>
<h2 id="related" class="tsd-anchor-link">Related<a href="#related" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p><a href="https://github.com/witchcraftjs/expressit">@witchcraft/expressit (boolean parser)</a>
<a href="https://github.com/alanscodelog/parsekey">Parsekey (shortcuts parser)</a></p>
<h1 id="faq" class="tsd-anchor-link">FAQ<a href="#faq" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1>
<details>
<summary>Browser shortcuts interfere with certain shortcuts, how can this be avoided?</summary>
<p>You can use a listener on the manager to e.preventDefault() some of these, but this doesn't work for all of them.</p>
<p>If available you can also try using the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Keyboard_API">Keyboard API's</a> lock method (see <a href="https://developer.mozilla.org/en-US/docs/Web/API/Keyboard_API#keyboard_locking">Keyboard Locking</a> ).</p>
</details>
<details>
<summary>How to label keys with their local names?</summary>
<p>If the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Keyboard_API">Keyboard API</a> is available, you can use it's <a href="https://developer.mozilla.org/en-US/docs/Web/API/Keyboard/getLayoutMap">navigator.keyboard.getLayoutMap method.</a>. Helpers (getKeyboardLayoutMap and labelWithNavigator) are provided for this purpose, see them for details.</p>
</details>
<details>
<summary>How to set multiple manager properties safely (i.e. batch replace shortcuts/commands/keys)?</summary>
<p>This can be an issue because there isn't a way to tell the manager you want to replace <em>multiple</em> properties and it might be impossible to, for example, replace commands with a smaller subset but not have it error even if you're planning to replace the shortcuts so they don't contain missing commands.</p>
<p>To achieve this:</p>
<p>You can shallow clone the manager, change all the properties you want directly, then validate it's state by using isValidManager.</p>
<p>Once you know it's valid, detach the old manager and attach the new one.</p>
<pre><code class="ts"><span class="hl-7">detach</span><span class="hl-2">(</span><span class="hl-3">manager</span><span class="hl-2">, ...)</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">clone</span><span class="hl-2"> = {...</span><span class="hl-3">manager</span><span class="hl-2">, </span><span class="hl-3">keys:</span><span class="hl-2"> </span><span class="hl-3">newKeys</span><span class="hl-2">, </span><span class="hl-3">shortcuts:</span><span class="hl-2"> </span><span class="hl-3">newShortcuts</span><span class="hl-2">}</span><br/><br/><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-7">isValidManager</span><span class="hl-2">(</span><span class="hl-3">manager</span><span class="hl-2">)) {</span><br/><span class="hl-2">	</span><span class="hl-7">attach</span><span class="hl-2">(</span><span class="hl-3">clone</span><span class="hl-2">, ...)</span><br/><span class="hl-2">}</span><br/>
</code><button type="button">Copy</button></pre>

</details>
<details>
<summary>How to create `modifier-only` shortcuts? (e.g. a shortcut `Ctrl` that changes the some state like enabling multiple selection).</summary>
<p>To do this, instead of clearing the manager's chain, you just set the state directly.</p>
<pre><code class="ts"><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">enableMultiSelect</span><span class="hl-2"> = </span><span class="hl-7">createCommand</span><span class="hl-2">(</span><span class="hl-4">&quot;enableMultiSelect&quot;</span><span class="hl-2">, {</span><br/><span class="hl-2">	</span><span class="hl-7">execute</span><span class="hl-3">:</span><span class="hl-2"> ({</span><span class="hl-3">isKeydown</span><span class="hl-2">}) </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">		</span><span class="hl-3">state</span><span class="hl-2">.</span><span class="hl-3">multiSelect</span><span class="hl-2"> = </span><span class="hl-3">isKeydown</span><br/><span class="hl-2">	}</span><br/><span class="hl-2">})</span><br/><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">shortcut</span><span class="hl-2"> = </span><span class="hl-7">createShortcut</span><span class="hl-2">({</span><br/><span class="hl-2">	</span><span class="hl-3">chain:</span><span class="hl-2"> [[</span><span class="hl-4">&quot;ControlLeft&quot;</span><span class="hl-2">]],</span><br/><span class="hl-2">	</span><span class="hl-3">command:</span><span class="hl-2"> </span><span class="hl-3">enableMultiSelect</span><span class="hl-2">.</span><span class="hl-3">name</span><span class="hl-2">,</span><br/><span class="hl-2">}, </span><span class="hl-3">manager</span><span class="hl-2">).</span><span class="hl-7">unwrap</span><span class="hl-2">()</span><br/><span class="hl-7">addShortcut</span><span class="hl-2">(</span><span class="hl-3">shortcut</span><span class="hl-2">, </span><span class="hl-3">manager</span><span class="hl-2">).</span><span class="hl-7">unwrap</span><span class="hl-2">()</span>
</code><button type="button">Copy</button></pre>

<p>While the click on some item could be handled by a shortcut, usually you will want to handle it in your framework:</p>
<pre><code class="vue">// vue
<template>
	<button
		v-for="item in items"
		:class="twMerge(
			state.multiSelect && `cursor-pointer`
		`)"
		@click="addToSelected(item)"
	></button>
</template>
<script setup>
import { state } from "./state.js" // reactive({ multiSelect: false })
const selected = ref([])
function addToSelected(item) {
	if (state.multiSelect) {
		if (!selected.value.includes(item)) {
			selected.value.push(item)
		} 
	} else {
		selected.value = [item]
	}
}
</script>
</code><button type="button">Copy</button></pre>

</details>
<details>
<summary>How to show pretty shortcut strings to the user?</summary>
<p>To show a pretty stringified version of a shortcut, use <code>manager.options.stringifier.stringify(shortcut.chain, manager)</code>.</p>
<p>Here's an advanced example in vue that shows a hint only when needed:</p>
<pre><code class="ts"><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">usageInstructions</span><span class="hl-2"> = </span><span class="hl-7">computed</span><span class="hl-2">(() </span><span class="hl-5">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">	</span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">manager</span><span class="hl-2"> = </span><span class="hl-3">shortcuts</span><span class="hl-2">.</span><span class="hl-3">activeManager</span><span class="hl-2">!.</span><span class="hl-3">value</span><span class="hl-2">!</span><br/><span class="hl-2">	</span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">s</span><span class="hl-2"> = </span><span class="hl-3">manager</span><span class="hl-2">.</span><span class="hl-3">options</span><span class="hl-2">.</span><span class="hl-3">stringifier</span><br/><span class="hl-2">	</span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">context</span><span class="hl-2"> = </span><span class="hl-3">shortcuts</span><span class="hl-2">.</span><span class="hl-3">context</span><span class="hl-2">!</span><br/><span class="hl-2">	</span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">isDragging</span><span class="hl-2"> = </span><span class="hl-3">context</span><span class="hl-2">.</span><span class="hl-3">value</span><span class="hl-2">.</span><span class="hl-3">layout</span><span class="hl-2">.</span><span class="hl-3">drag</span><span class="hl-2">.</span><span class="hl-3">isDragging</span><br/><span class="hl-2">	</span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-6">splitChain</span><span class="hl-2"> = </span><span class="hl-3">manager</span><span class="hl-2">.</span><span class="hl-3">shortcuts</span><span class="hl-2">.</span><span class="hl-3">entries</span><span class="hl-2">.</span><span class="hl-7">find</span><span class="hl-2">(</span><span class="hl-3">_</span><span class="hl-2"> </span><span class="hl-5">=&gt;</span><span class="hl-2"> </span><span class="hl-3">_</span><span class="hl-2">.</span><span class="hl-3">command</span><span class="hl-2"> === </span><span class="hl-6">LAYOUT_COMMANDS</span><span class="hl-2">.</span><span class="hl-3">dragModifierSplit</span><span class="hl-2">)?.</span><span class="hl-3">chain</span><br/><span class="hl-2">		</span><br/><span class="hl-2">	</span><span class="hl-1">return</span><span class="hl-2"> </span><span class="hl-3">isDragging</span><span class="hl-2"> &amp;&amp; </span><span class="hl-3">splitChain</span><br/><span class="hl-2">		</span><span class="hl-4">`Hold </span><span class="hl-5">${</span><span class="hl-3">s</span><span class="hl-10">.</span><span class="hl-7">stringify</span><span class="hl-10">(</span><span class="hl-3">splitChain</span><span class="hl-10">, </span><span class="hl-3">manager</span><span class="hl-10">)</span><span class="hl-5">}</span><span class="hl-4"> to Split`</span><span class="hl-2"> </span><br/><span class="hl-2">		: </span><span class="hl-5">undefined</span><span class="hl-2">,</span><br/><span class="hl-2">})</span>
</code><button type="button">Copy</button></pre>

</details>
<details>
<summary>How to type the context?</summary>
<p>Types can be extended multiple times from different files so long as the <code>NAME</code> part below is unique for each extension.</p>
<pre><code class="ts"><span class="hl-5">declare</span><span class="hl-2"> </span><span class="hl-5">module</span><span class="hl-2"> </span><span class="hl-4">&quot;@witchcraft/spellcraft/types&quot;</span><span class="hl-2"> {</span><br/><span class="hl-0">// or for nuxt</span><br/><span class="hl-0">// declare module &quot;#witchcraft/spellcraft/types.js&quot; {</span><br/><span class="hl-2">	</span><span class="hl-1">export</span><span class="hl-2"> </span><span class="hl-5">interface</span><span class="hl-2"> </span><span class="hl-8">Register</span><span class="hl-2"> {</span><br/><span class="hl-2">		</span><span class="hl-3">ShortcutManagerContextNAME</span><span class="hl-2">: { </span><span class="hl-0">//replace NAME with something</span><br/><span class="hl-2">			</span><span class="hl-0">// extend types here</span><br/><span class="hl-2">		}</span><br/><span class="hl-2">	}</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

</details></div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#spellcraft-ðŸª„"><span>Spellcraft ðŸª„</span></a><a href="#docs"><span>Docs</span></a><a href="#demo-please-report-any-issues"><span>Demo (please report any issues)</span></a><a href="#features"><span>Features</span></a><a href="#usage"><span>Usage</span></a><ul><li><ul><li><a href="#listening-to-events"><span>Listening to <wbr/>Events</span></a></li></ul></li><li><a href="#how-does-it-work"><span>How <wbr/>Does <wbr/>It <wbr/>Work?</span></a></li><li><a href="#errors-and-checking-if-actions-can-be-performed"><span>Errors and <wbr/>Checking if <wbr/>Actions can be <wbr/>Performed</span></a></li></ul><a href="#advanced-usage-building-the-manager-piece-by-piece"><span>Advanced <wbr/>Usage -<wbr/> <wbr/>Building the <wbr/>Manager <wbr/>Piece by <wbr/>Piece</span></a><ul><li><a href="#manager-options"><span>Manager <wbr/>Options</span></a></li><li><a href="#keys-and-layouts"><span>Keys and <wbr/>Layouts</span></a></li><li><a href="#commands"><span>Commands</span></a></li><li><a href="#conditions"><span>Conditions</span></a></li><li><a href="#contexts"><span>Contexts</span></a></li><li><a href="#shortcuts"><span>Shortcuts</span></a></li><li><a href="#changingsetting-properties-and-hooks"><span>Changing/<wbr/>Setting <wbr/>Properties and <wbr/>Hooks</span></a></li><li><a href="#managing-multiple-managers"><span>Managing <wbr/>Multiple <wbr/>Managers</span></a></li><li><a href="#other-helpers-and-utilities"><span>Other <wbr/>Helpers and <wbr/>Utilities</span></a></li><li><a href="#more-examples"><span>More <wbr/>Examples</span></a></li><li><a href="#usage-with-frameworks"><span>Usage with <wbr/>Frameworks</span></a></li></ul><a href="#development"><span>Development</span></a><ul><li><a href="#notes"><span>Notes</span></a></li><li><a href="#related"><span>Related</span></a></li></ul><a href="#faq"><span>FAQ</span></a></div></details></div><div class="site-menu"><nav id="tsd-sidebar-links" class="tsd-navigation"><a href="https://github.com/witchcraftjs/spellcraft" class="tsd-nav-link">Github</a><a href="https://github.com/witchcraftjs/spellcraft/issues" class="tsd-nav-link">Issues</a><a href="http://npmjs.com/@witchcraft/spellcraft" class="tsd-nav-link">npm</a></nav><nav class="tsd-navigation"><a href="modules.html">@witchcraft/spellcraft</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
